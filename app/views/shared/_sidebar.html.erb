<!-- Sidebar -->
<aside class="hidden md:flex w-72 h-screen sticky top-0 bg-white text-black border-r border-gray-200">
  <div class="flex flex-col w-full">
    <!-- Brand -->
    <div class="px-6 pt-6 pb-4 border-b border-gray-200">
      <%= link_to root_path, class: "group block" do %>
        <div class="text-[22px] font-extrabold tracking-tight text-red-600 group-hover:underline">
          Common Cosmetics
        </div>
        <div class="text-xs text-gray-500 mt-0.5">beauty • posts • vibes</div>
      <% end %>
    </div>

    <!-- Nav -->
    <nav class="flex-1 px-3 py-4 space-y-1 overflow-y-auto">
      <%# Class presets %>
      <% pill_base     = "group relative flex items-center gap-3 px-4 py-2 rounded-xl transition select-none focus:outline-none focus:ring-2 focus:ring-red-500/30" %>
      <% pill_hover    = "hover:bg-red-50 hover:text-red-700" %>
      <% pill_active   = "bg-red-600 text-white" %>
      <% pill_inactive = "text-gray-700" %>

      <% if user_signed_in? %>
        <!-- View Profile -->
        <% is_profile_active = current_page?(username_profile_path(username: current_user.username)) %>
        <%= link_to username_profile_path(username: current_user.username),
                    aria: { current: (is_profile_active ? "page" : nil) },
                    class: [pill_base, pill_hover, (is_profile_active ? pill_active : pill_inactive)].join(" ") do %>
          <% if current_user.avatar.attached? %>
            <%= image_tag current_user.avatar.variant(resize_to_fill: [40, 40]),
                          class: "h-10 w-10 rounded-full object-cover border border-gray-200" %>
          <% else %>
            <div class="h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center font-semibold text-white">
              <%= current_user.username[0].upcase %>
            </div>
          <% end %>
          <div class="min-w-0">
            <div class="font-semibold truncate">@<%= current_user.username %></div>
            <div class="text-xs text-gray-500">View profile</div>
          </div>
          <% if is_profile_active %>
            <span class="absolute left-0 top-1/2 -translate-y-1/2 h-6 w-1 rounded-full bg-white/90"></span>
          <% end %>
        <% end %>

        <!-- Home -->
        <% is_home_active =
             current_page?(root_path) ||
             (defined?(feed_path) && current_page?(feed_path)) ||
             (controller_name == "posts" && action_name.in?(%w[index feed])) %>
        <%= link_to root_path,
                    aria: { current: (is_home_active ? "page" : nil) },
                    class: [pill_base, pill_hover, (is_home_active ? pill_active : pill_inactive)].join(" ") do %>
          <% if is_home_active %>
            <span class="absolute left-0 top-1/2 -translate-y-1/2 h-6 w-1 rounded-full bg-white/90"></span>
          <% end %>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 flex-none" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="m3 9.75 9-6 9 6V19.5A1.5 1.5 0 0 1 19.5 21h-3.75v-6h-7.5v6H4.5A1.5 1.5 0 0 1 3 19.5V9.75z"/>
          </svg>
          <span class="font-medium">Home</span>
        <% end %>

        <!-- Create Post -->
        <%= link_to (defined?(new_post_path) ? new_post_path : "#"),
                    class: "flex items-center justify-center gap-2 px-4 py-2.5 rounded-2xl bg-red-600 text-white font-semibold hover:bg-red-700 active:scale-[.99] transition shadow-sm",
                    data: { turbo: true } do %>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 flex-none" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 4.5v15m7.5-7.5h-15"/>
          </svg>
          <span>Post</span>
        <% end %>

        <!-- Notifications -->
        <% is_notifications_active = controller_name == "notifications" %>
        <%= link_to notifications_path,
                    aria: { current: (is_notifications_active ? "page" : nil) },
                    class: [pill_base, pill_hover, (is_notifications_active ? pill_active : pill_inactive)].join(" ") do %>
          <% if is_notifications_active %>
            <span class="absolute left-0 top-1/2 -translate-y-1/2 h-6 w-1 rounded-full bg-white/90"></span>
          <% end %>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 flex-none" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
              d="M14.857 17.657A4.001 4.001 0 0112 21a4.001 4.001 0 01-2.857-3.343M6 8a6 6 0 1112 0c0 7 3 7 3 7H3s3 0 3-7z" />
          </svg>
          <span class="font-medium">Notifications</span>
          <% unread_count = current_user.notifications.unread.count %>
          <% if unread_count.positive? %>
            <span class="ml-auto inline-flex items-center justify-center rounded-full text-[10px] leading-none px-2 py-0.5 bg-red-600 text-white">
              <%= unread_count %>
            </span>
          <% end %>
        <% end %>

        <!-- Spacer pushes bottom items down -->
        <div class="flex-1"></div>

        <!-- Edit Profile -->
        <% is_edit_active = current_page?(edit_user_registration_path) %>
        <%= link_to edit_user_registration_path,
                    aria: { current: (is_edit_active ? "page" : nil) },
                    class: [pill_base, pill_hover, (is_edit_active ? pill_active : pill_inactive)].join(" ") do %>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 flex-none" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16.862 3.487a1.875 1.875 0 1 1 2.651 2.651L7.5 18.151 3 19.5l1.349-4.5L16.862 3.487z"/>
          </svg>
          <span class="font-medium">Edit Profile</span>
          <% if is_edit_active %>
            <span class="absolute left-0 top-1/2 -translate-y-1/2 h-6 w-1 rounded-full bg-white/90"></span>
          <% end %>
        <% end %>

        <!-- Sign Out -->
        <%= button_to destroy_user_session_path,
                      method: :delete,
                      form: { class: "contents", data: { turbo: false } },
                      class: "#{pill_base} #{pill_hover} #{pill_inactive} inline-flex items-center gap-3" do %>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 flex-none" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6A2.25 2.25 0 0 0 5.25 5.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15M12 9l4.5 3L12 15m4.5-3H9"/>
          </svg>
          <span class="font-medium">Sign Out</span>
        <% end %>

      <% else %>
        <!-- Login -->
        <% is_login_active = current_page?(new_user_session_path) %>
        <%= link_to new_user_session_path,
                    aria: { current: (is_login_active ? "page" : nil) },
                    class: [pill_base, pill_hover, (is_login_active ? pill_active : pill_inactive)].join(" ") do %>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 flex-none" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15.75 7.5a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.5 20.25a7.5 7.5 0 0 1 15 0"/>
          </svg>
          <span class="font-medium">Login</span>
        <% end %>

        <!-- Sign Up -->
        <% is_signup_active = current_page?(new_user_registration_path) %>
        <%= link_to new_user_registration_path,
                    aria: { current: (is_signup_active ? "page" : nil) },
                    class: [pill_base, pill_hover, (is_signup_active ? pill_active : pill_inactive)].join(" ") do %>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 flex-none" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="m9 4.5 1.5 3.75L14.25 9 10.5 10.5 9 14.25 7.5 10.5 3.75 9 7.5 8.25 9 4.5Zm7.5 5.25.75 1.875L19.125 12l-1.875.375L16.5 14.25l-.75-1.875L13.875 12l1.875-.375.75-1.875Z"/>
          </svg>
          <span class="font-medium">Sign Up</span>
        <% end %>
      <% end %>
    </nav>

    <!-- Footer -->
    <footer class="px-6 py-4 border-t border-gray-200 text-xs text-gray-500">
      &copy; <%= Time.current.year %> Common Cosmetics
    </footer>
  </div>
</aside>
