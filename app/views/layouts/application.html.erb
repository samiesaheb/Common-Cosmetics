<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) || "Common Cosmetics" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">

    <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
    <%= javascript_include_tag "application", "data-turbo-track": "reload", type: "module" %>
  </head>

  <body class="min-h-screen bg-white text-gray-900 flex">
    <!-- Sidebar -->
    <%= render "shared/sidebar" %>

    <!-- Main Content Area -->
    <main class="flex-1">
      <!-- Header (search, auth, etc.) -->
      <%= render "shared/header" %>

      <div class="p-6">
        <div class="mx-auto w-full max-w-2xl">
          <%# ---- Single, deduped, auto-dismissing flash area ---- %>
          <% printed = [] %>
          <% flash.each do |type, message| %>
            <% next if message.blank? || printed.include?(message.to_s) %>
            <% printed << message.to_s %>

            <% css = case type.to_sym
                     when :notice then "bg-green-100 text-green-800"
                     when :alert, :error then "bg-red-100 text-red-800"
                     else "bg-gray-100 text-gray-800"
                     end %>

            <div
              data-controller="flash"
              data-flash-timeout-value="3000"
              class="<%= css %> p-3 rounded mb-4 text-center transition-opacity duration-500"
              data-turbo-temporary
            >
              <%= message %>
            </div>
          <% end %>
          <%# Clear flashes so Turbo/history can't re-insert them %>
          <% flash.clear %>

          <%= yield %>
        </div>
      </div>
    </main>
  </body>
</html>